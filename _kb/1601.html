---
title: "How to workaround a failed promote/demote (rethinkdb/etcd mismatch)"
id: 1601
draftstate: inactive
deleted: false
layout: docs
permalink: /kb/1601/
originalpath: https://success.docker.com/KBase/How_to_workaround_a_failed_promote%2F%2Fdemote_(rethinkdb%2F%2Fetcd_mismatch)
source: https://success.docker.com/@api/deki/pages/1601/contents
tags:
- tag: "article:howto"
- tag: "component:ucp"
- tag: "product:datacenter"
- tag: "special:ownership"
---
{% raw %}
<div class="mt-section" id="section_1" mt-section-origin="KBase/How_to_workaround_a_failed_promote//demote_(rethinkdb//etcd_mismatch)">
 <div class="mt-section" id="section_1" mt-section-origin="KBase/How_to_workaround_a_failed_promote//demote_(rethinkdb//etcd_mismatch)">
  <span id="Workaround_failed_promote.2Fdemote_(rethinkdb.2Fetcd_mismatch)_within_UCP">
  </span>
  <h1 id="0-0">
   Workaround failed promote/demote (rethinkdb/etcd mismatch) within UCP
  </h1>
  <p>
   Under certain circumstances promotion or demotion may get stuck, resulting in a manager node reporting
   <code>
    [Pending] Node is being reconfigured (11%)
   </code>
  </p>
  <p>
   <img alt="Details" class="internal" src="/kb/images/1601-0.png"/>
  </p>
  <p>
   If you view the
   <code>
    Agent Log
   </code>
   the following failure information will be reported
  </p>
  <pre>
[ERROR] Unable to promote node to controller: unsuccessful node promote request: node promotion failed: etcd and rethinkdb cluster healthcheck failed: mismatch between etcd (2) and rethinkdb (1) replica count
</pre>
  <p>
   <img alt="Log" class="internal" src="/kb/images/1601-1.png"/>
  </p>
  <div class="mt-section" id="section_2" mt-section-origin="KBase/How_to_workaround_a_failed_promote//demote_(rethinkdb//etcd_mismatch)">
   <span id="Recovery_Procedure">
   </span>
   <h2 id="1-0">
    Recovery Procedure
   </h2>
   <p>
    Determining the
    <strong>
     actual
    </strong>
    number of expected controllers in the system, then run the following command (replacing "2" with the actual number for your environment)
   </p>
   <pre>
<code class="bash">docker ps --filter name=ucp-kv -q | wc -l
</code></pre>
   <pre>
<code class="bash">docker exec ucp-auth-api enzi $(docker inspect --format '{{ index .Args 0 }}' ucp-auth-api) --debug reconfigure-db --num-replicas 2
</code></pre>
  </div>
 </div>
</div>
{% endraw %}
<a href="/troubleshoot/universal-control-plane/" class="button outline-btn">Continue troubleshooting Universal Control Plane</a><br><a href="/troubleshoot/docker-datacenter/" class="button outline-btn">Continue troubleshooting Docker Datacenter</a><br>